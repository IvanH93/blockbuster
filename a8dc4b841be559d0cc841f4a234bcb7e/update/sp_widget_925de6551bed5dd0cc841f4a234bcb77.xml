<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller=function($scope) {
  /* widget controller */
  var c = this;
	$scope.userCreatedSuccessfully=false;
	$scope.createNewUser=function(){
		if(!$scope.f_name || !$scope.l_name || !$scope.email || !$scope.u_name || !$scope.password){
			alert("Riempire tutti i campi");
		}
		c.data.newuser={
			"fname":$scope.f_name,
			"lname":$scope.l_name,
			"uname":$scope.u_name,
			"email":$scope.email,
			"password":$scope.password,
			"ruolo":$scope.ruolo
		};
		c.data.action="createUser";
		c.server.update().then(function(){
			if(c.data.usercreated){
				$scope.userCreatedSuccessfully=true;
			}else{
				alert("Username giÃ  esistente");
			}
		});
	};
};]]></client_script>
        <controller_as>c</controller_as>
        <css>.form, .submit-btn-div{
  width:400px;
  margin:20px auto;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>op_register</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>Operator register</name>
        <option_schema/>
        <public>true</public>
        <roles/>
        <script><![CDATA[(function() {
    /* populate the 'data' object */
    /* e.g., data.table = $sp.getValue('table'); */
    if (input) {
        if (input.action == "createUser") {
            if (!getUserExist(input.newuser)) {
                var newuser = input.newuser;
                var op = new GlideRecord("x_849476_blockbust_operatore");
                op.initialize();
                op.first_name = newuser.fname;
                op.last_name = newuser.lname;
                op.username = newuser.uname;
                op.email = newuser.email;
                op.password = newuser.password;
								op.ruolo=newuser.ruolo;
                op.insert();
                data.usercreated = true;
            } else {
                data.usercreated = false;
            }


        }
    }

})();

function getUserExist(newuser) {
    var user = new GlideRecord("sys_user");
    user.addQuery("user_name=" + newuser.uname);
    user.query();
    if (user.next()) {
        return true;
    } else {
        return false;
    }
}]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2022-08-25 15:18:42</sys_created_on>
        <sys_id>925de6551bed5dd0cc841f4a234bcb77</sys_id>
        <sys_mod_count>30</sys_mod_count>
        <sys_name>Operator register</sys_name>
        <sys_package display_value="Blockbuster" source="x_849476_blockbust">a8dc4b841be559d0cc841f4a234bcb7e</sys_package>
        <sys_policy/>
        <sys_scope display_value="Blockbuster">a8dc4b841be559d0cc841f4a234bcb7e</sys_scope>
        <sys_update_name>sp_widget_925de6551bed5dd0cc841f4a234bcb77</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2022-09-01 10:54:08</sys_updated_on>
        <template><![CDATA[<div style="color:#000">
  <div ng-show="!userCreatedSuccessfully">
 <div class="form">
   <div>
     <label> Nome </label>
     <input class="form-control" type="text" ng-model="f_name" placeholder="Nome"/>
   </div>
    <div>
     <label> Cognome </label>
     <input class="form-control" type="text" ng-model="l_name" placeholder="Cognome"/>
   </div>
    <div>
     <label> Email </label>
     <input class="form-control" type="text" ng-model="email" placeholder="Email"/>
   </div>
    <div>
     <label> Username </label>
     <input class="form-control" type="text" ng-model="u_name" placeholder="Username"/>
   </div>
    <div>
     <label> Password </label>
     <input class="form-control" type="password" ng-model="password" placeholder="Password"/>
   </div>
   <div>
     <label for="cars">Ruolo:</label>
      <select class="form-control" ng-model="ruolo">
       <option selected="selected" value="terminalista">Terminalista</option>
       <option value="scaffalista">Scaffalista</option>
      </select>
   </div>
  </div>
  <div class="submit-btn-div">
    <button class="btn btn-primary" ng-click="createNewUser()">
      Submit
    </button>
  </div>
</div>
<div ng-show="userCreatedSuccessfully" class="text-center">
  <h2>
    Operatore inserito! torna alla home
  </h2>
  <a class="btn btn-primary" href="/Blockbuster">
    Home
  </a>
</div>
</div>
]]></template>
    </sp_widget>
</record_update>
